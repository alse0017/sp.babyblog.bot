<h1>Бот для загрузки товаров на сайт sp.babyblog.ru</h1>
Разработан на yii2 framework basic template/.<br>Бот парсит товары с других сайтов(постащиков) и загружает их на бебиблог в закупку. А также обновляет уже добавленные товары, только те которые были добавлены самим ботом. И деактивирует/активирует товары, которые стали недоступны или наоборот появились в наличии у поставщика. 


### База данных

Добавьте файл `config/db.php` с настройками подключения к базе:
```php
return [
    'class' => 'yii\db\Connection',
    'dsn' => 'mysql:host=localhost;dbname=yii2basic',
    'username' => 'root',
    'password' => '1234',
    'charset' => 'utf8',
];
```

Выполните миграции
```php
php yii migrate
```

### Доступы к Babyblog

Настройте доступы к sp.babyblog.ru здесь `http://localhost/options/update/?code=babyblog`

### Описание таблиц

<ul>
<li>
    <b>supplier</b> - Профили загрузки поставщиков.<br>
    Важные поля
    <ul>
    <li><i>babyblog_shop_id</i> - ID закупки на бебиблог;</li>
    <li><i>babyblog_buyout_id</i> - ID выкупа на бебиблог(без него не загружаются товары);</li>
    <li><i>import_status</i> - текущий статус загрузки. "import" - загружается, "after_import" - выполняются действия после загрузки(например деактивируются товары, которых небыло в выгрузке), "stop" - загрузка остановлена;</li>
    <li><i>max_price</i> - максимальная цена товаров, которые будут загружены. Необходимо, если есть ограничение. Если поставить, то нет ограничений;</li>
    <li><i>import_init_data</i> - данные для загрузчика в json формате. Здесь может быть всё что угодно. Например сопоставление ID категорий поставщика с категориями бебиблога;</li>
    <li><i>import_data</i> - временные данные для загрузчика, копируются из import_init_data при каждом новом старте загрузки;</li>
    </ul>
</li>
<li><b>supplier_product</b> - Товары поставщиков. Cначала товары парсятся в эту таблицу, затем из этой таблицы добавляются/обновляются в таблицу babyblog_product.</li>
<li><b>babyblog_product</b> - Товары бебиблога</li>
<li><b>option</b> - Различные настройки</li>
</ul>

### Загрузка товаров на бебиблог

На данный момент реализована загрузка товаров с сайта постащика Ernest.<br> 
Для инициализации и старта загрузки, необходимо запустить консольные команды: <br><br>
`php yii ernest-import/init` - Cбрасывает все настройки загрузки в начало, удаляет товары поставщика из таблицы supplier_product.<br><br>
`php yii ernest-import/run` - Запускает загрузку. Эту команду необходимо запустить и оставить консоль открытой. Данный процесс занимает продолжительное время.
```